{% extends "base.html" %} {% block content %}
<div class="header">
  <h2>Мої закладки</h2>
</div>

<div class="apartment-list">
  {% if apartments %}
    {% for apartment in apartments %}
      <div class="apartment-card">
        <h3><a href="/apartments/{{ apartment.id }}">{{ apartment.title }}</a></h3>
        <img src="{{ url_for('static', path='images/default-image.jpg') }}" alt="Image">
        <p><strong>Ціна:</strong> {{ apartment.price }} грн</p>
        <p><strong>Розташування:</strong> {{ apartment.location.city }}, вул. {{ apartment.location.street }}, буд. {{ apartment.location.house_number }}</p>
        <div class="apartment-card-actions">
          <a href="/apartments/{{ apartment.id }}" class="btn">Переглянути</a>
          <button onclick="removeFromObservations('{{ apartment.id }}', this.parentNode.parentNode)" class="btn btn-remove">Видалити з закладок</button>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="empty-message">
      <p>У вас поки немає збережених квартир. Додайте квартири в закладки, щоб відстежувати їх тут.</p>
      <a href="/" class="btn">Переглянути доступні квартири</a>
    </div>
  {% endif %}
</div>

<script>
  function removeFromObservations(apartmentId, cardElement) {
    if (confirm("Видалити цю квартиру з закладок?")) {
      fetch(`/apartments/${apartmentId}/observe`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        },
        credentials: 'same-origin'
      })
      .then(response => response.json())
      .then(data => {
        // Remove the apartment card from the UI
        cardElement.remove();
        
        // Check if there are any apartments left
        const apartmentList = document.querySelector('.apartment-list');
        if (apartmentList.children.length === 0) {
          apartmentList.innerHTML = `
            <div class="empty-message">
              <p>У вас поки немає збережених квартир. Додайте квартири в закладки, щоб відстежувати їх тут.</p>
              <a href="/" class="btn">Переглянути доступні квартири</a>
            </div>
          `;
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert("Помилка при видаленні з закладок");
      });
    }
  }
</script>

<style>
  .empty-message {
    text-align: center;
    padding: 2rem;
    background-color: #f9f9f9;
    border-radius: 5px;
    margin: 2rem 0;
  }
  
  .apartment-list {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 20px;
  }
  
  .apartment-card {
    width: 300px;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  
  .apartment-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 3px;
  }
  
  .apartment-card-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
  }
  
  .btn {
    padding: 5px 10px;
    border-radius: 3px;
    border: none;
    cursor: pointer;
    text-decoration: none;
    color: white;
    background-color: #4caf50;
  }
  
  .btn-remove {
    background-color: #f44336;
  }
</style>
{% endblock %} 